# ai-qa

Инструмент для генерации и валидации JSON-инструкций Playwright с помощью LangChain, LangGraph и Playwright.

Теперь генерация шагов реактивная: перед обращением к LLM агент проверяет, нет ли подходящего "тула" для конкретного шага (например, эвристика заполнения форм). Если тул умеет собирать инструкцию, она попадает в цикл ревью и валидации; иначе включается LLM.

## Требования

* Python 3.10+
* Установленные зависимости проекта (`pip install -e .`)
* Установленный Playwright драйвер (`playwright install`)
* Переменная окружения `GIGACHAT_CREDENTIALS` либо токен, переданный через `--credentials`,
  для авторизации в [GigaChat](https://developers.sber.ru/docs/ru/gigachain/overview)

## Использование

```bash
python -m ai_qa.agent \
  --base-url "https://example.com" \
  --test-case "1. Открыта главная страница 2. Нажать кнопку ..." \
  --credentials "$GIGACHAT_CREDENTIALS"
```

Или можно передать файл со сценарием:

```bash
python -m ai_qa.agent --base-url https://example.com --test-case-file case.txt
```

CLI принимает токен и передаёт его напрямую в конструктор `langchain_gigachat.GigaChat`,
используя те же параметры, что и в официальном примере.

Во время исполнения агент:

1. Строит граф выполнения на LangGraph для каждого шага сценария.
2. Подбирает способ генерации: сначала опрашивает зарегистрированные тула (например, для заполнения форм), а если подходящего нет или пользователь потребовал LLM, вызывает языковую модель.
3. Показывает инструкцию пользователю, позволяет вручную заменить селекторы, вставить готовый JSON или потребовать новую генерацию (в том числе принудительно через LLM).
4. Проверяет существование селекторов в живой странице Playwright до выполнения.
5. Выполняет инструкцию и при любой ошибке возвращается к повторной генерации с учётом фидбэка и текста ошибки.

После успешного прохождения всех шагов выводится история с итоговыми инструкциями и количеством повторов.
